# Template file for 'unityhub'
pkgname=unityhub
version=3.9.1
revision=1
archs="x86_64"
create_wrksrc=yes
hostmakedepends="tar"
short_desc="Unity Hub - Manage Unity Editor installations"
maintainer="Your Name <your.email@example.com>"
license="Proprietary"
homepage="https://unity.com/unity-hub"
distfiles="https://hub.unity3d.com/linux/repos/deb/pool/main/u/unity/unityhub_amd64/unityhub-amd64-${version}.deb"
checksum=64db1588b4f4b059c7795dc5bc914f41b27df668290f6ac7f9b64e3863e02210
repository=nonfree
restricted=yes
nopie=yes
nostrip=yes

do_extract() {
    cd ${wrksrc}
    ar x ${XBPS_SRCDISTDIR}/${pkgname}-${version}/unityhub-amd64-${version}.deb
    
    # Find and extract the data archive
    if [ -f data.tar.xz ]; then
        tar xf data.tar.xz
    elif [ -f data.tar.gz ]; then
        tar xf data.tar.gz
    elif [ -f data.tar.bz2 ]; then
        tar xf data.tar.bz2
    elif [ -f data.tar.zst ]; then
        tar xf data.tar.zst
    elif [ -f data.tar ]; then
        tar xf data.tar
    else
        msg_error "No data.tar.* archive found\n"
    fi
}

do_install() {
    # Install application files to /opt
    vmkdir opt/unityhub
    vcopy opt/unityhub/* opt/unityhub
    
    # Install desktop file
    vmkdir usr/share/applications
    
    # Install icon if present
    if [ -f opt/unityhub/unityhub.png ]; then
        vinstall opt/unityhub/unityhub.png 644 usr/share/pixmaps
    fi
    
    # Create desktop entry
    cat > ${DESTDIR}/usr/share/applications/unityhub.desktop <<EOF
[Desktop Entry]
Name=Unity Hub
Comment=Manage Unity Editor installations
Exec=/opt/unityhub/unityhub %U
Icon=unityhub
Terminal=false
Type=Application
Categories=Development;
EOF
    
    # Create wrapper script
    vmkdir usr/bin
    cat > ${DESTDIR}/usr/bin/unityhub <<EOF
#!/bin/sh
exec /opt/unityhub/unityhub "\$@"
EOF
    chmod 755 ${DESTDIR}/usr/bin/unityhub
}
