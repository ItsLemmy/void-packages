# Template file for 'elephant'
pkgname=elephant
version=2.14.3
revision=1
hostmakedepends="go pkg-config"
makedepends="wayland-devel"
depends="wl-clipboard libqalculate qalculate fd"
short_desc="General purpose datasource and executor"
maintainer="ItsLemmy <studio@quadbyte.net>"
license="GPL-3.0-or-later"
homepage="https://github.com/abenz1267/elephant"
distfiles="${homepage}/archive/refs/tags/v${version}.tar.gz"
checksum=9201a52063f45d918a6362b08730f439d0e922445b86fb5dc9cc742e9a50046d
nopie=yes

do_build() {
    # Build main elephant binary
    cd cmd/elephant
    go build -buildvcs=false -o elephant -trimpath
    cd ${wrksrc}

    # Build providers as plugins
    local providers="bluetooth calc clipboard desktopapplications files menus nirisessions providerlist runner snippets symbols todo unicode websearch windows"
    for provider in ${providers}; do
        cd internal/providers/${provider}
        go build -buildvcs=false -buildmode=plugin -trimpath -o ${provider}.so
        cd ${wrksrc}
    done
}

do_install() {
    # Install main binary
    vbin cmd/elephant/elephant

    # Install providers
    vmkdir etc/xdg/elephant/providers
    local providers="bluetooth calc clipboard desktopapplications files menus nirisessions providerlist runner snippets symbols todo unicode websearch windows"
    for provider in ${providers}; do
        vinstall internal/providers/${provider}/${provider}.so 755 etc/xdg/elephant/providers
    done

    vlicense LICENSE
}